
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CNLS with multiple outputs &#8212; pyStoNED 0.4.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CQR (CER) with multiple outputs" href="cqer_ddf.html" />
    <link rel="prev" title="StoNED with Z variables" href="../z/stoned_z.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="cnls-with-multiple-outputs">
<h1>CNLS with multiple outputs<a class="headerlink" href="#cnls-with-multiple-outputs" title="Permalink to this headline">¶</a></h1>
<p>Until now, the CNLS/StoNED framework has been presented in the single output,
multiple input setting. In this part we describe the CNLS estimator
within the directional distance function (DDF) framework, Chambers et al. (1996,1998).</p>
<p>Consider the following QP problem</p>
<div class="math notranslate nohighlight">
\begin{align*}
    &amp; \underset{\alpha, \beta, \varepsilon} {min} \sum_{i=1}^n\varepsilon_i^2 \\
    &amp; \text{s.t.} \\
    &amp;  \gamma_i^{'}y_i = \alpha_i + \beta_i^{'}X_i - \varepsilon_i \quad \forall i \\
    &amp;  \alpha_i + \beta_i^{'}X_i -\gamma_i^{'}y_i \le \alpha_j + \beta_j^{'}X_i -\gamma_j^{'}y_i \quad  \forall i, j\\
    &amp;  \gamma_i^{'} g^{y}  + \beta_i^{'} g^{x}  = 1  \quad \forall i \\
    &amp;  \beta_i \ge 0 , \gamma_i \ge 0 \quad  \forall i \\
\end{align*}</div><p>Here the residual <span class="math notranslate nohighlight">\(\hat{\varepsilon}_i\)</span> represents the estimated value of <cite>d</cite>
(<span class="math notranslate nohighlight">\(\vec{D}(x_i,y_i,g^x,g^y)+u_i\)</span>). We also introduce new firm-specific coefficients
<span class="math notranslate nohighlight">\(\gamma_i\)</span> that represent marginal effects of outputs to the DDF.
The first constraint defines the distance to the frontier as a linear function of inputs
and outputs. The linear approximation of the frontier is based on the tangent hyperplanes,
analogous to the original CNLS formulation. The second set of constraints is the
system of Afriat inequalities thatimpose global concavity. The third constraint
is a normalization constraint that ensures the translation property. The last
two constraints impose monotonicity in allinputs and outputs. It is straightforward
to show that the CNLS estimator of function <cite>d</cite> satisfies the axioms of free disposability,
convexity, and the translation property.</p>
<p>When considering undesirable outputs, the above CNLS-DDF problem can be reformulated as</p>
<div class="math notranslate nohighlight">
\begin{align*}
    &amp; \underset{\alpha, \beta, \varepsilon} {min} \sum_{i=1}^n\varepsilon_i^2 \\
    &amp; \text{s.t.} \\
    &amp;  \gamma_i^{'}y_i = \alpha_i + \beta_i^{'}X_i + \delta_i^{'}b_i - \varepsilon_i \quad \forall i \\
    &amp;  \alpha_i + \beta_i^{'}X_i + \delta_i^{'}b_i -\gamma_i^{'}y_i \le \alpha_j + \beta_j^{'}X_i + \delta_j^{'}b_i -\gamma_j^{'}y_i \quad  \forall i, j\\
    &amp;  \gamma_i^{'} g^{y}  + \beta_i^{'} g^{x} + \delta_i^{'}g^{b} = 1  \quad \forall i \\
    &amp;  \beta_i \ge 0, \delta_i \ge 0, \gamma_i \ge 0 \quad  \forall i \\
\end{align*}</div><div class="section" id="example-1-ipynb">
<h2>Example #1 <a class="reference external" href="https://colab.research.google.com/github/ds2010/pyStoNED/blob/master/sources/notebooks/DDF_withoutUndesirableOutput.ipynb">[.ipynb]</a><a class="headerlink" href="#example-1-ipynb" title="Permalink to this headline">¶</a></h2>
<p>In the following code, we first estimate the DDF without considering the undesirable outputs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import packages</span>
<span class="kn">from</span> <span class="nn">pystoned</span> <span class="kn">import</span> <span class="n">CNLSDDF</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># import Finnish electricity distribution firms data</span>
<span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://raw.githubusercontent.com/ds2010/pyStoNED/master/sources/data/firms.csv&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># outputs</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Length&#39;</span><span class="p">]</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">y3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Customers&#39;</span><span class="p">]</span>
<span class="n">y3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">y3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># inputs</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;OPEX&#39;</span><span class="p">]</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">]</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># define and solve the CNLS-DDF model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CNLSDDF</span><span class="o">.</span><span class="n">CNLSDDF</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fun</span> <span class="o">=</span> <span class="s2">&quot;prod&quot;</span><span class="p">,</span> <span class="n">gx</span><span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">gb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gy</span><span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">remote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># display the estimates (alpha, beta, gamma, and residual)</span>
<span class="n">model</span><span class="o">.</span><span class="n">display_alpha</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">display_beta</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">display_gamma</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">display_residual</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2-ipynb">
<h2>Example #2 <a class="reference external" href="https://colab.research.google.com/github/ds2010/pyStoNED/blob/master/sources/notebooks/DDF_UndesirableOutput.ipynb">[.ipynb]</a><a class="headerlink" href="#example-2-ipynb" title="Permalink to this headline">¶</a></h2>
<p>Now we take the undesirable outputs into considertion, the python code is presented as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import packages</span>
<span class="kn">from</span> <span class="nn">pystoned</span> <span class="kn">import</span> <span class="n">CNLSDDF</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># import OECD countries data</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/ds2010/pyStoNED/master/sources/data/countries.csv&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># inputs</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;HRSN&#39;</span><span class="p">]</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;CPNK&#39;</span><span class="p">]</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asmatrix</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># good output</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;VALK&#39;</span><span class="p">]</span>

<span class="c1"># bad output</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;GHG&#39;</span><span class="p">]</span>

<span class="c1"># define and solve the CNLS-DDF model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CNLSDDF</span><span class="o">.</span><span class="n">CNLSDDF</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="s2">&quot;prod&quot;</span><span class="p">,</span> <span class="n">gx</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">gb</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gy</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">remote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># display the estimates (alpha, beta, gamma, delta, and residual)</span>
<span class="n">model</span><span class="o">.</span><span class="n">display_alpha</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">display_beta</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">display_gamma</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">display_delta</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">display_residual</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">pyStoNED</a></h1>



<p class="blurb">A package for StoNED in Python</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=ds2010&repo=StoNED-Python&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/index.html">Install</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../datasets/index.html">Datasets</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#convex-nonparametric-least-square">Convex Nonparametric Least Square</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#stochastic-nonparametric-envelopment-of-data">Stochastic Nonparametric Envelopment of Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#contextual-variables">Contextual Variables</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#multiple-outputs-ddf-formulation">Multiple Outputs (DDF Formulation)</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">CNLS with multiple outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="cqer_ddf.html">CQR (CER) with multiple outputs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#convex-quantile-approaches">Convex Quantile Approaches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#monotonic-models">Monotonic Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#data-envelopment-analysis">Data Envelopment Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#free-disposal-hull">Free Disposal Hull</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/index.html">Advanced topics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../citing/index.html">Citing pyStoNED</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../free_course/index.html">Free online course</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../acronyms/index.html">List of Acronyms</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Examples</a><ul>
      <li>Previous: <a href="../z/stoned_z.html" title="previous chapter">StoNED with Z variables</a></li>
      <li>Next: <a href="cqer_ddf.html" title="next chapter">CQR (CER) with multiple outputs</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, The pyStoNED authors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/examples/DDF/cnls_ddf.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>